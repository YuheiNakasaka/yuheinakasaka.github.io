<html>
  <head>
    <title>canvas縦書き力技 Demo</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <script type="text/javascript" src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
    <style type="text/css">
    #canvas {
      background-color: #ddd;
    }
    </style>
  </head>
  <body onload="start();">
    <h1>canvas縦書き力技 Demo</h1>
    <h2>Code</h2>
    <pre>
  function _verticalWrite (ctx) {
    var textList = "ぉωTょレヽTょレヽ＜世レニτ〃ヵゝレナゑωτ〃￡ヵゝ？(＊・艸・)プ世ω世レヽ体育祭(≠τ＜яёTょレヽωτ〃￡ヵゝァ??ぅちら黄組ゐT=〃ヵゝら応援Ｕτ＜T=〃±レヽЙё★先生レ￡Tょレニ＜〃ゐTょωτ〃￡ヵゝ？ヵゝぇッτ(≠T=ら∧ωＵ〃∋ЗＵ＜".split('\n');
    var lineHeight = ctx.measureText("あ").width+margin;
    textList.forEach(function(elm, i) {
      [].forEach.call(elm, function(ch, j) {
        ctx.fillStyle = "rgba(0,0,0,1)"; // 文字色
        if(ch.match(/「|『/) !== null) {
          // 鍵かっこ始まり
          ctx.fillText(ch, x-lineHeight*0.5, y+lineHeight*j);
        } else if(ch.match(/」|』/) !== null) {
          // 鍵かっこ終わり
          ctx.fillText(ch, x+lineHeight*0.6, y+lineHeight*j);
        } else if(ch.match(/、|。|,|\./) !== null) {
          // 点系
          ctx.fillText(ch, x+lineHeight*0.6, y+lineHeight*j);
        } else if (ch.match(/\||i|l|I|!/) !== null) {
          // 縦棒系
          ctx.fillText(ch, x+lineHeight*0.25, y+lineHeight*j);
        } else if (ch.match(/ー|ー|－|―|〜|~/) !== null) {
          // 回転縦棒系
          ctx.save();
          ctx.translate(x,y+lineHeight*(j-1));
          ctx.rotate(Math.PI/2);
          ctx.fillText(ch, 5, -2);
          ctx.restore();
        } else if (ch.match(/\(|\)|\[|\]|【|】/) !== null) {
          // 回転括弧系
          ctx.save();
          ctx.translate(x,y+lineHeight*(j-1));
          ctx.rotate(Math.PI/2);
          ctx.fillText(ch, 5, -4.5);
          ctx.restore();
        } else if (ch.match(/=/) !== null) {
          // 回転イコール
          ctx.save();
          ctx.translate(x,y+lineHeight*(j-1));
          ctx.rotate(Math.PI/2);
          ctx.fillText(ch, 10, -4);
          ctx.restore();
        } else if (ch.match(/[0-9a-zA-Z&%$#"']+/) != null) {
          // 半角とか
          ctx.fillText(ch, x+lineHeight*0.1, y+lineHeight*j);
        } else {
          // その他
          ctx.fillText(ch, x-lineHeight*i, y+lineHeight*j);
        }
      });
    });
  };
    </pre>
    <h2>Demo</h2>
    <canvas id="canvas"></canvas>
  <script>
  var fontSize = 30;
  var width = $(window).width();
  var height = 24000;
  var x = (width/2)-fontSize;
  var y = 40;
  var margin = 5;

  function start() {
    // 生成GIFのメインcanvas
    var canvas = $("#canvas")[0];
    var context = canvas.getContext('2d');
    canvas.width = width;
    canvas.height = height;
    _reset(context);
    _verticalWrite(context);
  }

  function _verticalWrite (ctx) {
  var textList = "┐□･/├工･/ﾞ/″二了ﾚﾆ矢ロっτもらﾚヽﾅﾆﾚヽ└|ﾉヾ─ｽ┐°□≠ﾞ/＠重要小生|RickyNews⊇＠言己亊ｶゞ目ﾚﾆ入っτ言売ωτ″ゐﾅﾆ。ﾅょゑﾚまー⊂″、日乍今ﾚよReverseProxyﾚよイ更禾リﾅょLﾌ｣ﾚ─勺─白勺ﾅょも＠ー⊂ιτ言忍言音戈､ﾅれτﾚヽゑ＠ﾅﾆ″ﾅょ、ー⊂思っﾅﾆ。URL＠Rewriteゃ、VirtualHost云々。石寉ｶゝﾚﾆReverseProxy＠イ更禾リﾅょイ貝リ面τ″ﾚよぁゑ一方、ξれらﾚよNginxﾅょー⊂″＠ReverseProxyτ″ﾅょﾚﾅれﾚよ″実装ｶゞ不可能ｶゝー⊂言ぇﾚよ″ξωﾅょ⊇ー⊂ﾚよﾅょﾚヽも＠τ″もぁゑ。自分ﾚよReverseProxyﾚよもぅす⊇ι廾─ﾉヾ─/ｨ･/┐ﾗ白勺ﾅょイ貝リ面τ″ξ＠彳殳害リを才足ぇτﾚヽゑ。今更イ可をー⊂ﾚヽぅも＠τ″もぁゑｶゞ、昼イ木ゐｶゞτら日寺間ｶゞぁゑ＠τ″簡単ﾚﾆ書ﾚヽτゐょぅ。ReverseProxyﾚよWebﾞ/ｽ〒厶全イ夲＠└|｀／─ｽ最適イヒ＠ﾅﾆめ＠ﾉヽ°─\"/ReverseProxy＠ｨ･/┐ﾗ白勺ﾅょネ見点τ″＠彳殳害リﾚよ「Webﾞ/ｽ〒厶全イ夲＠系ﾚﾆぉﾚﾅゑ└|｀／─ｽ全イ夲最適＠ﾅﾆめ＠部品」τ″ぁゑ。ﾅょω＠⊇っちゃ･･･ごめω、石才殳ﾚﾅ″ﾅょﾚヽτ″。己攵めτReverseProxyﾚよReverseProxyを┐□･/├工･/├″Railsτ″もPlackτ″もイ可τ″もﾚヽﾚヽ＠ﾅﾆ″ｶゞξ＠了┐°└|ヶ─ﾞ/ｮ･/廾─ﾉヾ─をﾉヾッ勹工･/├″ー⊂ιﾅﾆー⊂､ｷﾚﾆ┐□･/├工･/├″τ″裁ﾚﾅゑも＠ﾚよ┐□･/├工･/├″τ″ﾉヾッ勹工･/├″τ″ﾅょﾚﾅれﾚよ″夂几王里τ″､ｷﾅょﾚヽも＠ﾅﾆ″ﾚﾅﾉヾッ勹工･/├″τ″夂几王里すゑょぅﾚﾆι「全イ夲＠└|｀／─ｽ交力率を上ﾚﾅ″まιょぅ」ー⊂ﾚヽぅﾅﾆめ＠も＠τ″ぁゑ。ﾏ｣ﾚ于┐°□ｾｽﾓ〒″｣ﾚー⊂並彳テ夂几王里小生能最ぇ斤ﾚよﾚヽзﾚヽзﾅょ実装ｶゞぁゑ＠τ″一木艮旡ﾚﾆﾚよ言ぇﾅょﾚヽ＠ﾅﾆ″ｶゞ、Web了┐°└|ヶ─ﾞ/ｮ･/ﾚﾆょゑﾉヾッ勹工･/├″＠了┐°└|ヶ─ﾞ/ｮ･/廾─ﾉヾ─τ″ﾚよ、牛寺ﾚﾆｽ勹└|┐°├言言吾ﾚﾆぉﾚヽτﾚよ、ξれﾚよﾏ｣ﾚ于┐°□ｾｽﾓ〒″｣ﾚを才采用ιτﾚヽゑ⊇ー⊂ｶゞﾚまー⊂ωー⊂″ﾅﾆ″。ﾏ｣ﾚ于┐°□ｾｽﾓ〒″｣ﾚτ″ﾚよ、｜└|勹工ｽ├を｜┐°□ｾｽｶゞ才旦当すゑ⊇ー⊂ﾚﾆﾅょゑ。従っτ、｜ﾞ/ｽ〒厶τ″ｚｏ┐°□ｾｽｶゞ走己重力ιτﾚヽﾅﾆー⊂すゑー⊂同日寺ﾚﾆ夂几王里τ″､ｷゑ並彳テ夂几王里数ﾚよ最大τ″ｚｏ└|勹工ｽ├ー⊂ﾚヽぅ⊇ー⊂ﾚﾆﾅょゑ。ご存矢ロ＠ょぅﾚﾆ了┐°└|ヶ─ﾞ/ｮ･/廾─ﾉヾ─ﾚよ乂ﾓ└|を大量ﾚﾆシ肖費すゑ。乂ﾓ└|イ吏用量ー⊂ﾚヽぅ文脈τ″「重ﾚヽ」ー⊂言ぇゑ。ξ＠ﾅﾆめ、ЗｚGBー⊂ｶゝー⊂″ωﾅょﾚﾆシ閏シ尺ﾚﾆ乂ﾓ└|ｶゞ石寉イ呆τ″､ｷゑﾝ|犬シ兄τ″も、せﾚヽぜﾚヽ最大┐°□ｾｽ数ﾚよ、すﾅょゎち並彳テ夂几王里小生能ﾚよｓｏー⊂ｶゝ｜ｏｏー⊂ｶゝξ＠＜″らﾚヽτ″ぁゑ。Webﾞ/ｽ〒厶ｶゞ応答ιﾅょﾚﾅれﾚよ″ﾚヽﾚﾅﾅょﾚヽ＠ﾚよ、イ歹リぇﾚよ″/loginﾚﾆ来ﾅﾆ｜└|勹工ｽ├ﾚﾆ文寸ιτξ＠画面ｶゞ含￡ヽ画イ象、JavaScript、CSSξ＠イ也大量＠了ｾッ├を含￡ヽ。ReverseProxyを導入ιτﾚヽﾅょﾚヽﾞ/ｽ〒厶τ″ﾚよ⊇れら＠す∧″τﾚﾆ了┐°└|ヶ─ﾞ/ｮ･/廾─ﾉヾ─ｶゞ応答ιﾅょﾚﾅれﾚよ″ﾅょらﾅょﾚヽ。⊇⊇ｶゞ問是頁。夲来了┐°└|ヶ─ﾞ/ｮ･/廾─ﾉヾ─ﾚよ、重力白勺ﾅょ└|勹工ｽ├を夂几王里すゑﾅﾆめﾚﾆ用意､ﾅれτﾚヽゑも＠τ″ぁゑﾚﾆも関ゎらず、重力白勺τ″ﾅょﾚヽ］･/〒･/\"‘/ﾚﾆまτ″応答ιﾅょﾚﾅれﾚよ″ﾅょらﾅょﾚヽ･･･ー⊂ﾚヽぅ＠τ″、先ﾚﾆゐﾅﾆょぅﾚﾆ貴重ﾅょ了┐°└|ヶ─ﾞ/ｮ･/廾─ﾉヾ─┐°□ｾｽｶゞ、ー⊂″ぅτ″もﾚヽﾚヽ青争白勺┐ァｨ｣ﾚ＠└|勹工ｽ├ﾅょー⊂″ﾚﾆもシ肖費､ﾅれτιまぅ、＠τ″ぁゑ。ReverseProxyτ″得意ﾅょも＠ﾚよ得意ﾅょ人ｶゞ応答すゑょぅﾚﾆすゑξ⊇τ″ReverseProxyを入れτ、(ﾈッ├ﾜ─勹白勺ﾚﾆ)了┐°└|ヶ─ﾞ/ｮ･/廾─ﾉヾ─＠手前ﾚﾆ酉己置すゑ。ξιτ青争白勺┐ァｨ｣ﾚﾅょー⊂″、了┐°└|ヶ─ﾞ/ｮ･/廾─ﾉヾ─を介､ﾅずﾚﾆ応答τ″､ｷゑも＠ﾚよReverseProxyｶゞ直才妾勹ﾗｨ了･/├ﾚﾆ応答ι、了┐°└|ヶ─ﾞ/ｮ･/廾─ﾉヾ─τ″ﾅょﾚﾅれﾚよ″応答τ″､ｷﾅょﾚヽ└|勹工ｽ├＠ゐ了┐°└|ヶ─ﾞ/ｮ･/廾─ﾉヾ─ﾚﾆ車云送すゑ。ReverseProxyﾚよ、(了┐°└|ヶ─ﾞ/ｮ･/廾─ﾉヾ─ｶゞﾏ｣ﾚ于┐°□ｾｽﾓ〒″｣ﾚτ″ぁゑ＠ー⊂文寸照白勺ﾚﾆ)日乍今＠土易合Nginx＠ょぅﾚﾆﾞ/･/勹″｣ﾚ┐°□ｾｽ・ｨ∧″･/├├″└|┐″･/ﾅょ了─≠〒勹于ｬ＠実装＠も＠を用ﾚヽゑ。⊇＠了─≠〒勹于ｬﾚよ、ー⊂″ωﾅょﾚﾆ大量＠└|勹工ｽ├ｶゞ来τも┐°□ｾｽ数ﾚよ土曽ゃ､ﾅずﾚﾆ］･/〒≠ｽ├ｽｨッ于･/勹″＠ゐ(CPU白勺ﾅょ意ロ未＠］･/〒≠ｽ├ｽｨッ于･/勹″τ″ﾚよﾅょ＜、ｨ∧″･/├＠意ロ未τ″＠。具イ夲白勺ﾚﾆﾚよselectゃepollﾚﾆ類すゑﾞ/ｽ〒厶］─｣ﾚ)τ″並彳テ夂几王里小生能を禾家＜″ー⊂⊇зｶゞ禾リ点。ξ＠ﾅﾆめ乂ﾓ└|イ吏用量＠文脈τ″ﾚよ「軽ﾚヽ」。⊇＠「重ﾚヽ」了┐°└|ヶ─ﾞ/ｮ･/廾─ﾉヾ─ー⊂「軽ﾚヽ」ReverseProxyを糸且ゐ合ゎせτξれξ″れ自分ｶゞ得意ﾅょも＠ﾅﾆ″ﾚﾅ才旦当すゑ⊇ー⊂τ″、ﾞ/ｽ〒厶全イ夲＠系τ″ゐﾅﾆー⊂､ｷﾚﾆ└|｀／─ｽ交力率を全イ夲最適､ﾅせまιょぅ･･･ー⊂ﾚヽぅ＠ｶゞｨ･/┐ﾗネ見点τ″ReverseProxyを導入ιﾅﾆﾚヽ一番＠王里由τ″ぁゑ。ReverseProxyﾚよﾈッ├ﾜ─勹白勺ﾚﾆぇ犀ﾚヽ勹ﾗｨ了･/├ゃ、KeepAlive└|勹工ｽ├、ぁゑﾚヽﾚよ大､ｷﾅょ┐ァｨ｣ﾚを了ッ┐°□─├″ιτ＜ゑ勹ﾗｨ了･/├ﾅょー⊂″「ぁま丶)イ士亊ﾚよιﾅょﾚヽﾚﾅー⊂″ﾈッ├ﾜ─勹才妾糸売＠糸隹才寺ﾚよ要求､ﾅれゑ」､ﾅれゑょぅﾅょイ貝リ面τ″も彳殳ﾚﾆ立⊃。ξれらﾚよReverseProxyイ貝リτ″夂几王里ιτぉ､ｷ、了┐°└|ヶ─ﾞ/ｮ･/廾─ﾉヾ─ﾚﾆﾚよ夲当ﾚﾆ必要ﾅょー⊂､ｷﾅﾆ″ﾚﾅﾚﾆιｶゝ└|勹工ｽ├を車云送ιﾅょﾚヽ･･･ﾅﾆー⊂ぇﾚよ″ぇ犀ﾚヽ勹ﾗｨ了･/├＠HTTP└|勹工ｽ├ｶゞす∧″τ着イ言ιτｶゝら車云送、KeepAliveﾚよ┐□･/├ﾅﾆ″ﾚﾅ有交力ﾚﾆιτぉ､ｷﾉヾッ勹工･/├″ﾚよ応答ｶゞ糸冬ゎっﾅﾆらξ＜七刀断、了ッ┐°□─├″┐ァｨ｣ﾚﾚよ糸冬ゎゑまτ″┐□･/├イ貝リτ″ﾉヾッ┐ァ└|･/勹″･･･ﾅょー⊂″τ″ぁゑ。⊇＠彳殳害リ分才旦ｶゞ、更ﾚﾆ得意ﾅょも＠ﾚよ得意ﾅょー⊂⊇зτ″、ー⊂ﾚヽぅ└|｀／─ｽ全イ夲最適イヒﾚﾆ寄与すゑ。四方山⊇＠ぇ刀ｶゞReverseProxyﾚﾆ求められゑ彳殳害リ＠主車由τ″、Lﾌ白勺ﾅょイ更禾リ木幾能･･･URL＠Rewriteー⊂ｶゝ┐□･/├工･/├″イ貝リτ″＠了勹ｾｽ制彳卸ー⊂ﾚヽぅ＠ﾚよぁ＜まτ″副ン欠白勺ﾅょ要素ﾚﾆぇ咼､ｷ″ﾅょﾚヽ･･･ー⊂ﾚヽぅ＠ｶゞｨ･/┐ﾗネ見点τ″＠言忍言音戈τ″ﾚよぁゑ。まぁ、┐□･/├工･/├″工･/ﾞ/″二了└|･/勹″ｶゝらιﾅﾆらξ＠ネ見点ｶゞ逆車云すゑ、ー⊂ﾚヽぅ＠ﾚよゎｶゝらﾅょ＜もﾅょﾚヽ。ちﾅょゐﾚﾆ最ぇ斤ﾚよAmazon＠CloudFrontﾅょー⊂″CDNを上ヒ車交白勺ヵﾞ/″ｭ了｣ﾚﾚﾆイ吏ぇゑょぅﾚﾆﾅょっﾅﾆ＠τ″、青争白勺┐ァｨ｣ﾚ＠酉己イ言ﾚﾆ関ιτﾚよCDNﾅﾆ″ﾚﾅτ″貝有っτιまぅー⊂ﾚヽぅ力業をイ吏ぅイ歹リも土曽ぇτゑ気もすゑ。イ固人白勺ﾚﾆﾚよ、ξ＠副ン欠白勺ﾅょ用ぇ余＠鬼未力も大､ｷﾚヽ＠τ″、CDNﾚﾆイ吏ぅﾚﾆιτもRerverseProxyぁっﾅﾆﾚまぅｶゞﾚヽﾚヽょー⊂ﾚよ思ぅﾚﾅー⊂″。･･･書ﾚヽτゑぅちﾚﾆﾅﾆ″ωﾅﾆ″ω├″ﾔ彦頁ﾚﾆﾅょっτ､ｷτιまっﾅﾆ。すゐませω。自分＠矢ロ言音戈ｶゞぁゑ禾呈度正ιﾚヽー⊂ﾚヽぅ思ﾚヽぇ入ゐを前才是ﾚﾆ、､ｷちωー⊂⊇＠ぇ刀＠背景亊小青を糸売＜世イ弋ﾚﾆ継承ιτﾚヽﾚﾅﾅﾆらー⊂も思ぅー⊂⊇зτ″す。ちﾅょゐﾚﾆ、⊇＠ぇ刀ﾚよ『廾─ﾉヾ─/ｨ･/┐ﾗを支ぇゑ才支彳朮テ』ー⊂ﾚヽぅ(ー⊂っτも)素日青らιﾚヽ夲ﾚﾆ言羊ι＜書ｶゝれτﾚヽゑ＠τ″⊇ちらを言売￡ヽー⊂良ﾚヽー⊂思ぅ。".split('\n');
    var lineHeight = ctx.measureText("あ").width+margin;
    textList.forEach(function(elm, i) {
      [].forEach.call(elm, function(ch, j) {
        ctx.fillStyle = "rgba(0,0,0,1)"; // 文字色
        if(ch.match(/「|『/) !== null) {
          // 鍵かっこ始まり
          ctx.fillText(ch, x-lineHeight*0.5, y+lineHeight*j);
        } else if(ch.match(/」|』/) !== null) {
          // 鍵かっこ終わり
          ctx.fillText(ch, x+lineHeight*0.6, y+lineHeight*j);
        } else if(ch.match(/、|。|,|\./) !== null) {
          // 点系
          ctx.fillText(ch, x+lineHeight*0.6, y+lineHeight*j);
        } else if (ch.match(/\||i|l|I|j|!/) !== null) {
          // 縦棒系
          ctx.fillText(ch, x+lineHeight*0.25, y+lineHeight*j);
        } else if (ch.match(/ー|ー|－|―|〜|~/) !== null) {
          // 回転縦棒系
          ctx.save();
          ctx.translate(x,y+lineHeight*(j-1));
          ctx.rotate(Math.PI/2);
          ctx.fillText(ch, 5, -2);
          ctx.restore();
        } else if (ch.match(/\(|\)|\[|\]|【|】/) !== null) {
          // 回転括弧系
          ctx.save();
          ctx.translate(x,y+lineHeight*(j-1));
          ctx.rotate(Math.PI/2);
          ctx.fillText(ch, 5, -4.5);
          ctx.restore();
        } else if (ch.match(/=/) !== null) {
          // 回転イコール
          ctx.save();
          ctx.translate(x,y+lineHeight*(j-1));
          ctx.rotate(Math.PI/2);
          ctx.fillText(ch, 10, -4);
          ctx.restore();
        } else if (ch.match(/[0-9a-zA-Z&%$#"']+/) != null) {
          // 半角とか
          ctx.fillText(ch, x+lineHeight*0.1, y+lineHeight*j);
        } else if (ch.match(/\?/) != null) {
          // ?とか
          ctx.fillText(ch, x+lineHeight*0.16, y+lineHeight*j);
        } else {
          // その他
          ctx.fillText(ch, x-lineHeight*i, y+lineHeight*j);
        }
      });
    });
  };

  function _reset (ctx) {
    ctx.clearRect(0,0,width,height);
    ctx.font = fontSize + "px HGS明朝E";
    ctx.fillStyle = "rgba(255,255,255,1)"; // 文字色
    ctx.textAlign = 'left';
    ctx.lineWidth = 2; // 枠線の太さ
    ctx.lineJoin = 'round'; // アンチエイリアスっぽいやつ
    ctx.fillRect(0,0,width,height);
  }
  </script>
  </body>
</html>